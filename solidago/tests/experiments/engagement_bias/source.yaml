overwrite: true
reproducibility: true
max_workers: 1
variables:
 - generator.modules.7.distribution.std # engagement bias
 - functions.3.lipschitz # mehestan lipschitz
poll: null
generator:
  seed: 0
  modules:
    - [users.Users, {n_users: 3, distribution: [Normal, mean: [3.0, 0.0]]}]
    - [entities.Entities, {n_entities: 3, distribution: [Normal, dimension: 2]}]
    # User trust generation
    - [users.AddColumn, {column: is_trustworthy, distribution: [Bernoulli, p: 0.8]}]
    - [users.BernoulliPretrust, {p_if_trustworthy: 0.5, p_if_untrustworthy: 0.0}] # requires users.is_trustworthy
    # Vouch generation
    - [users.AddColumn, {column: expected_n_vouches, distribution: [Zipf, power_decay: 2.0]}]
    - [vouches.ErdosRenyi, {}] # requires users.expected_n_vouches
    # Engagement generation
    - - users.AddColumn
      - column: n_evaluated_entities
        distribution: [Add, subdistributions: [[Zipf, power_decay: 1.5], [Poisson, mean: 3.0]]]
    - [users.AddColumn, {column: engagement_bias, distribution: [Normal, {std: [0.0, 10.0]}]}]
    - [users.AddColumn, {column: p_public, distribution: [Deterministic, {value: 0.8}]}]
    - [users.AddColumn, {column: n_comparisons_per_entity, distribution: [Uniform, {min: 1.0, max: 5.0}]}]
    - - engagements.Independent # requires users.{n_evaluated_entities, p_public, p_assess, {p_compare | n_comparisons_per_entity}}
      - select_entities: [BiasedByScore, noise: [Normal, {}]] # requires users.{vector, n_evaluated_entities, engagement_bias} and entities.vector
    # User comparison
    - [users.AddColumn, {column: translation, distribution: [Normal, std: 1.0]}]
    - [users.AddColumn, {column: multiplier, distribution: [Gamma, {shape: 1.0, scale: 1.0}]}]
    - - comparisons.Independent
      - honest: [KnaryGBT, {n_options: 21, comparison_max: 10}]
        malicious: [Negate, {}]
functions:
  - [LipschiTrust, {pretrust_value: 0.8, decay: 0.8, sink_vouch: 5.0, error: 1.0e-8}]
  - - NumbaUniformGBT
    - prior_std_dev: 7
      uncertainty_nll_increase: 1.0
      max_uncertainty: 1.0e+3
      convergence_error: 1.0e-5
  - [AffineOvertrust, {privacy_penalty: 0.5, min_overtrust: 2.0, overtrust_ratio: 0.1}]
  - - Mehestan
    - lipschitz: [1.0, 100.0]
      min_scaler_activity: 1.0
      n_scalers_max: 100
      privacy_penalty: 0.5
      user_comparison_lipschitz: 10.0
      p_norm_for_multiplicative_resilience: 4.0
      n_entity_to_fully_compare_max: 100
      n_diffs_sample_max: 1000
      default_multiplier_dev: 0.5
      default_translation_dev: 1.0
      error: 1.0e-5
  - [LipschitzStandardize, {dev_quantile: 0.9, lipschitz: 10.0, error: 1.0e-5, n_sampled_entities_per_user: 100}]
  - [LipschitzQuantileShift, {quantile: 0.15, lipschitz: 10.0, error: 1.0e-5, target_score: 0.21, n_sampled_entities_per_user: 100}]
  - [EntitywiseQrQuantile, {quantile: 0.2, lipschitz: 0.1, error: 1.0e-5}]
  - [Squash, {score_max: 100}]